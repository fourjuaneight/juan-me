<!DOCTYPE HTML>
<html lang="{{ with .Site.LanguageCode }}{{ . }}{{ else }}en-US{{ end }}">
  <head>
      {{ .Hugo.Generator }}
  <meta charset="utf-8" />
  <base href="{{ .Site.BaseURL }}"/>
  <title>{{ $url := replace .Permalink ( printf "%s" .Site.BaseURL) "" }}{{ if eq $url "/" }}{{ .Site.Title }}{{ else }}{{ if .Params.heading }}{{ .Params.heading }}{{ else }}{{ .Title }}{{ end }}{{ end }}</title>
  <meta name="author" content="{{ .Site.Author.name }}">
  <meta name="description" content="{{ .Site.Params.meta.description }}">
  <meta name="keywords" content="{{ .Site.Params.meta.keywords }}">
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,initial-scale=1.0,maximum-scale=5.0,viewport-fit=cover">
  
  <!-- RSS -->
  {{ with .OutputFormats.Get "rss" -}}
      {{ printf `<link rel="%s" type="%s+%s" href="%s" title="%s" />` .Rel .MediaType.Type .MediaType.Suffix .Permalink $.Site.Title | safeHTML }}
  {{ end -}}
  
  <!-- Open Graph -->
  <link rel="canonical" href="{{ .Permalink }}">
  {{ template "_internal/twitter_cards.html" . }}
  <meta name="twitter:image" content="{{ .Site.BaseURL }}{{ "icons/avatar.png" | relURL }}">
  {{ template "_internal/opengraph.html" . }}
  <meta property="og:image" content="{{ .Site.BaseURL }}{{ "icons/avatar.png" | relURL }}">
  {{ template "_internal/schema.html" . }}

  <!-- Fonts -->  
  <link rel="preload" href={{ "type/IBMPlexSans-subset.woff2" | relURL }} as="font" type="font/woff2" crossorigin>
  <link rel="preload" href={{ "type/IBMPlexSans-subset.woff" | relURL }} as="font" type="font/woff" crossorigin>
  
  <!-- Critical -->
  {{ if eq .IsHome true }}
    {{ partial "critical-home.html" . }}
  {{ else }}
    {{ partial "critical-aboveTheFold.html" . }}
  {{ end }}

  <!-- Critical Font Loading -->
  <script>
    (function() {
      "use strict";
      // Optimization for Repeat Views
      if( sessionStorage.fontsLoadedCriticalFoftPreloadFallback ) {
        document.documentElement.className += " fonts-loaded-2";
        return;
      } else if( "fonts" in document ) {
        document.fonts.load("1em Plex Subset").then(function () {
          document.documentElement.className += " fonts-loaded-1";
          Promise.all([
            document.fonts.load("400 1em Plex"),
            document.fonts.load("600 1em Plex"),
            document.fonts.load("italic 1em Plex"),
            document.fonts.load("400 1em Plex Mono"),
            document.fonts.load("italic 1em Plex Mono"),
          ]).then(function () {
            document.documentElement.className += " fonts-loaded-2";
            // Optimization for Repeat Views
            sessionStorage.fontsLoadedCriticalFoftPreloadFallback = true;
          });
        });
      } else {
        // use fallback
        var ref = document.getElementsByTagName( "script" )[ 0 ];
        var script = document.createElement( "script" );
        {{ $criticalJS := resources.Get "js/critical-foft-preload-fallback-optional.js" | minify }}
        script.src = "{{ $criticalJS.Permalink }}";
        script.async = true;
        ref.parentNode.insertBefore( script, ref );
      }
    })();
    </script>
  
  <!-- Stylesheets -->
  {{ $styles := resources.Get "css/main.scss" | toCSS | postCSS | minify }}
  <link rel="stylesheet" href="{{ $styles.Permalink }}" media="screen">
  
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="{{ "icons/favicon.png" | relURL }}">

  <!-- Manifest -->
  <link rel="manifest" href="{{ "/manifest.json" | relURL }}">
  
  <!-- Webclip and Apple Touch Icon -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="{{ .Site.Title }}">
  <link rel="apple-touch-icon" sizes="152x152" href="{{ "icons/apple-touch-icon-152x152.png" | relURL }}">
  <link rel="apple-touch-icon" sizes="167x167" href="{{ "icons/apple-touch-icon-167x167.png" | relURL }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ "icons/apple-touch-icon-180x180.png" }}">
  <link rel="mask-icon" color="#8F3A6D" href="{{ "icons/safari-pinned-tab.svg" | relURL }}">

  <!-- Android Chrome Icon -->
  <link rel="android-chrome" sizes="128x128" href="{{ "icons/android-chrome-128x128.png" | relURL }}">
  <link rel="android-chrome" sizes="192x192" href="{{ "icons/android-chrome-192x192.png" | relURL }}">
  <link rel="android-chrome" sizes="512x512" href="{{ "icons/android-chrome-512x512.png" | relURL }}">
</head>
<body {{ if .IsHome }}id="home"{{ end }} class="light">
    <!-- Main content -->
  {{ block "main" . }}
  {{ end }}

  <!-- Theme Switcher -->
  {{ partial "dracula.html" . }}
  <script>
    var button = document.querySelector('#theme-switcher');
    var body = document.querySelector("body");
    button.onclick = function() {
      body.classList.toggle('dark');
    }
  </script>
  <!-- SW -->
  <script>
    if (navigator.serviceWorker) {
      navigator.serviceWorker.register("/sw.js", { scope: "/" });
      navigator.serviceWorker.ready.then(function(registration) {
        console.log("Service Worker Ready");
      });
      window.addEventListener("load", function() {
        if (navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({ command: "trimCaches" });
        }
      });
    }
  </script>
  <!-- Console Crap -->
  <script>
    function isIE() {
      ua = navigator.userAgent;
      var is_ie = ua.indexOf("MSIE ") > -1 || ua.indexOf("Trident/") > -1;
      return is_ie; 
    }
    if (isIE()){
      console.log('Fuck yeah it works on IE 11.');
    } 
    console.log('I love to sleep because in my dreams I can finally get revenge on the stingray that strangled Steve Irwin.');
  </script>
</body>
</html>